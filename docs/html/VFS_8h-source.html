<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>VFS.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>VFS.h</h1><a href="VFS_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00006 <font class="preprocessor">#ifndef __VFS_H</font>
00007 <font class="preprocessor"></font><font class="preprocessor">#define __VFS_H</font>
00008 <font class="preprocessor"></font>
00009 <font class="preprocessor">#define R_READ   1</font>
00010 <font class="preprocessor"></font><font class="preprocessor">#define R_WRITE  2</font>
00011 <font class="preprocessor"></font><font class="preprocessor">#define R_ALL    3</font>
00012 <font class="preprocessor"></font><font class="preprocessor">#define R_NONE   0</font>
00013 <font class="preprocessor"></font>
00014 <font class="preprocessor">#define NO_USER "none"</font>
00015 <font class="preprocessor"></font>
00016 <font class="preprocessor">#include &lt;cstdio&gt;</font>
00017 <font class="preprocessor">#include &lt;vector&gt;</font>
00018 <font class="preprocessor">#include &lt;list&gt;</font>
00019 <font class="preprocessor">#include &lt;deque&gt;</font>
00020 <font class="preprocessor">#include &lt;string&gt;</font>
00021 <font class="preprocessor">#include "<a class="code" href="DirectoryDatabase_8h.html">DirectoryDatabase.h</a>"</font>
00022 
00023 <font class="preprocessor">#include "<a class="code" href="my__exceptions_8h.html">my_exceptions.h</a>"</font>
00024 <font class="preprocessor">#include "<a class="code" href="VFS__file_8h.html">VFS_file.h</a>"</font>
00025 
00026 
00027 
00028 <font class="preprocessor">#define MAX_PATH_LEN 600</font>
00029 <font class="preprocessor"></font><font class="preprocessor">#define MAX_CFG_LINE_LEN 600</font>
00030 <font class="preprocessor"></font>
<a name="l00070"></a><a class="code" href="classVFS.html">00070</a> <font class="keyword">class </font><a class="code" href="classVFS.html">VFS</a> {
00071 <font class="keyword">public</font>:
00072     <a class="code" href="classVFS.html#a0">VFS</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> * path, <font class="keyword">const</font> <font class="keywordtype">char</font> * db_name) <font class="keywordflow">throw</font>(<a class="code" href="classVFSError.html">VFSError</a>, <a class="code" href="classGdbmError.html">GdbmError</a>, <a class="code" href="classFileError.html">FileError</a>);
00073     <a class="code" href="classVFS.html#a1">~VFS</a>();
00074     <font class="keywordtype">int</font>         <a class="code" href="classVFS.html#a2">ReloadConfigFile</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> * path);
00075     
00076     <font class="keywordtype">int</font>         <a class="code" href="classVFS.html#a3">ChangeDir</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> * path);
00077     string      <a class="code" href="classVFS.html#a4">CurrentDir</a>();
00078     string      <a class="code" href="classVFS.html#a5">CurrentPhysicalDir</a>();
00079     <font class="keywordtype">int</font>         <a class="code" href="classVFS.html#a6">ConvertToPhysicalPath</a>(string virtual_path, string &amp;physical_path);
00080     <font class="keywordtype">bool</font>        <a class="code" href="classVFS.html#a7">AllowedToWriteToDir</a>(string dir); 
00081 
00082     <font class="keywordtype">void</font>        <a class="code" href="classVFS.html#a8">ResetFiles</a>();
00083     <a class="code" href="classVFS__file.html">VFS_file</a>  * <a class="code" href="classVFS.html#a9">NextFile</a>();
00084     <font class="keywordtype">int</font>         <a class="code" href="classVFS.html#a10">GetFileInfo</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> * path, <a class="code" href="classVFS__file.html">VFS_file</a> &amp;x);
00085     <font class="keywordtype">int</font>         <a class="code" href="classVFS.html#a11">PutFileInfo</a>(<a class="code" href="classVFS__file.html">VFS_file</a> file);
00086     <font class="keywordtype">int</font>         <a class="code" href="classVFS.html#a12">DeleteFileInfo</a>(<a class="code" href="classVFS__file.html">VFS_file</a> file); 
00087     
00088     <font class="keywordtype">bool</font>        IgnoreHidden()     { <font class="keywordflow">return</font> ignore_hidden; }
00089     <font class="keywordtype">void</font>        IgnoreHidden(<font class="keywordtype">bool</font> x) { ignore_hidden = x; <a class="code" href="classVFS.html#o0">root_db</a>.<a class="code" href="classDirectoryDatabase.html#a6">IgnoreHidden</a>(x); }
00090     <font class="keywordtype">void</font>        PrintDb() { <a class="code" href="classVFS.html#o0">root_db</a>.<a class="code" href="classDirectoryDatabase.html#a8">PrintContent</a>(); }
00091     <font class="keywordtype">bool</font>        <a class="code" href="classVFS.html#a16">IsFile</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> * path);
00092     <font class="keywordtype">bool</font>        <a class="code" href="classVFS.html#a17">IsDir</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> * path);
00093     string      FtpUserName() {string s; s = ftp_user_name; <font class="keywordflow">return</font> s; }
00094     <font class="keywordtype">void</font>        FtpUserName(string x) { ftp_user_name = x; }
00095     
00096 <font class="keyword">private</font>:
00097     <font class="keywordtype">int</font>  <a class="code" href="classVFS.html#c0">LoadConfigFile</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> * path);
00098     <font class="keywordtype">int</font>  <a class="code" href="classVFS.html#c1">SimpleCd</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *dir);
00099     
00100     <font class="keyword">class </font>VFS_node {
00101     <font class="keyword">public</font>:
00102         VFS_node(<font class="keyword">const</font> <font class="keywordtype">char</font> * _vname = <font class="stringliteral">""</font>, <font class="keyword">const</font> <font class="keywordtype">char</font> * _pname = <font class="stringliteral">""</font>, VFS_node * _parent = 0);
00103         VFS_node * Parent() { <font class="keywordflow">return</font> parent; }
00104         VFS_node * NextChild(); <font class="comment">// vraci postupne potomky</font>
00105         VFS_node * LastChild(); <font class="comment">// vrati posledniho potomka - kvuli prochazeni cyklem</font>
00106         VFS_node * FindChild(string s); <font class="comment">// zjisti zda s odpovida nejakemu potomkovi</font>
00107         <font class="keywordtype">void</font> ResetChildren(); <font class="comment">// zpusobi, ze NextChild() vrati potomka na prvnim miste ve vectoru</font>
00108         <font class="keywordtype">void</font> AddChild(VFS_node * x)    { children.push_back(x); child_it = children.begin(); }
00109         <font class="keywordtype">int</font> NumOfChildren() { <font class="keywordflow">return</font> children.size(); }
00110         <font class="keywordtype">void</font> GetChildren(vector&lt;VFS_node *&gt; &amp;x) { x=children; }
00111         
00112         <font class="keywordtype">void</font> SetDir(<font class="keywordtype">bool</font> x)     { is_dir = x; }
00113         <font class="keywordtype">void</font> SetFile(<font class="keywordtype">bool</font> x)    { is_file = x; }
00114         <font class="keywordtype">void</font> SetUserName(string &amp;s)  { user_name = s; }
00115         <font class="keywordtype">void</font> SetUserRights(<font class="keywordtype">int</font> r)    { user_rights = r; }
00116         <font class="keywordtype">void</font> SetOthersRights(<font class="keywordtype">int</font> r)  { others_rights = r; }
00117         <font class="keywordtype">bool</font> <a class="code" href="classVFS.html#a17">IsDir</a>()     { <font class="keywordflow">return</font> is_dir; }
00118         <font class="keywordtype">bool</font> <a class="code" href="classVFS.html#a16">IsFile</a>()    { <font class="keywordflow">return</font> is_file; }
00119         <font class="keywordtype">bool</font> IsLeaf()    { <font class="keywordflow">return</font> children.empty(); }
00120         string VirtualName()  { string s; s=virtual_name; <font class="keywordflow">return</font> s; }
00121         string FullVirtualName();
00122         string PhysicalName() { string s; s=physical_name; <font class="keywordflow">return</font> s; }
00123         <font class="keywordtype">void</font>   PhysicalName(string &amp;x) { physical_name = x; }
00124         string UserName()     { string s; s=user_name; <font class="keywordflow">return</font> s; }
00125         <font class="keywordtype">int</font> UserRights()      { <font class="keywordflow">return</font> user_rights; }
00126         <font class="keywordtype">int</font> OthersRights()    { <font class="keywordflow">return</font> others_rights; }
00127 
00128     <font class="keyword">private</font>:
00129         <font class="keywordtype">bool</font> is_dir;
00130         <font class="keywordtype">bool</font> is_file;
00131         vector&lt;VFS_node *&gt; children;
00132         vector&lt;VFS_node *&gt;::iterator child_it;
00133         VFS_node * parent;
00134         string virtual_name; 
00135         string physical_name;
00136         string user_name;
00137         <font class="keywordtype">int</font> user_rights;
00138         <font class="keywordtype">int</font> others_rights;
00139     }; <font class="comment">//class VFS_node</font>
00140     
00141     
00142     <font class="keywordtype">void</font>        <a class="code" href="classVFS.html#c2">PreorderAction</a>(VFS_node * n, <font class="keywordtype">int</font> action(VFS_node * node, <font class="keywordtype">int</font> num), <font class="keywordtype">int</font> depth);
00143     <font class="keywordtype">void</font>        <a class="code" href="classVFS.html#c3">PostorderAction</a>(VFS_node * n, <font class="keywordtype">int</font> action(VFS_node * node, <font class="keywordtype">int</font> num), <font class="keywordtype">int</font> depth);
00144     VFS_node * <a class="code" href="classVFS.html#c4">_DirSecurityCheck</a>(VFS_node * n, string dir); 
00145     VFS_node * <a class="code" href="classVFS.html#c5">_FindNode</a>(VFS_node * n, string name);
00146     
00147     <font class="keyword">friend</font> <font class="keywordtype">int</font> <a class="code" href="classVFS.html#a2">PrintName</a>(VFS::VFS_node * node, <font class="keywordtype">int</font> depth); 
00148     <font class="keyword">friend</font> <font class="keywordtype">int</font> <a class="code" href="classVFS.html#a3">DeleteNode</a>(VFS::VFS_node * node, <font class="keywordtype">int</font>);
00149     
00150     <font class="keywordtype">int</font>         <a class="code" href="classVFS.html#c6">DestroyVirtualTree</a>();
00151     VFS_node *  <a class="code" href="classVFS.html#c7">DirSecurityCheck</a>(string dir);
00152     VFS_node *  <a class="code" href="classVFS.html#c8">FindNode</a>(string name);
00153        
<a name="l00154"></a><a class="code" href="classVFS.html#o0">00154</a>     <a class="code" href="classDirectoryDatabase.html">DirectoryDatabase</a> <a class="code" href="classVFS.html#o0">root_db</a>; 
<a name="l00155"></a><a class="code" href="classVFS.html#o1">00155</a>     VFS_node    * <a class="code" href="classVFS.html#o1">current_node</a>; 
<a name="l00156"></a><a class="code" href="classVFS.html#o2">00156</a>     VFS_node    * <a class="code" href="classVFS.html#o2">root_node</a>; 
<a name="l00157"></a><a class="code" href="classVFS.html#o3">00157</a>     DIR         * <a class="code" href="classVFS.html#o3">dir_desc</a>; 
00158     <font class="keywordtype">bool</font>          dir_changed;
00159     vector&lt;VFS_node *&gt; child_buf;
00160 
00161     <font class="keywordtype">bool</font>          ignore_hidden;
00162     string        ftp_user_name; 
00163     
<a name="l00170"></a><a class="code" href="classVFS.html#o8">00170</a>     string        <a class="code" href="classVFS.html#o8">current_dir</a>; 
00171     
00172 <font class="keyword">public</font>:
00173 
00174     <font class="keywordtype">void</font> <a class="code" href="classVFS.html#a20">PrintVirtualTree</a>();
00175     
00176 };
00177 
00178 
00179 <font class="preprocessor">#endif //__VFS_H</font>
00180 <font class="preprocessor"></font>
</pre></div><hr><address><small>Generated on Fri Sep 19 10:13:26 2003 for smallFTPd by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DirectoryDatabase.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>DirectoryDatabase.h</h1><a href="DirectoryDatabase_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00006 <font class="preprocessor">#ifndef __DirectoryDatabase_h</font>
00007 <font class="preprocessor"></font><font class="preprocessor">#define __DirectoryDatabase_h</font>
00008 <font class="preprocessor"></font>
00009 <font class="keyword">extern</font> <font class="stringliteral">"C"</font> {
00010 <font class="preprocessor">#include &lt;sys/types.h&gt;</font>
00011 <font class="preprocessor">#include &lt;sys/stat.h&gt;</font>
00012 <font class="preprocessor">#include &lt;unistd.h&gt;</font>
00013 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00014 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00015 <font class="preprocessor">#include &lt;fcntl.h&gt;</font>
00016 <font class="preprocessor">#include &lt;dirent.h&gt;</font>
00017 <font class="preprocessor">#include &lt;gdbm.h&gt;</font>
00018 <font class="preprocessor">#include &lt;errno.h&gt;</font>
00019 }
00020 <font class="preprocessor">#include "<a class="code" href="my__exceptions_8h.html">my_exceptions.h</a>"</font>
00021 <font class="preprocessor">#include &lt;iostream&gt;</font>
00022 <font class="preprocessor">#include &lt;string&gt;</font>
00023 
00024 <font class="preprocessor">#define GDBM_BLOCK_SIZE 512</font>
00025 <font class="preprocessor"></font>
00026 <font class="preprocessor">#define MAX_USER_NAME_LEN 20</font>
00027 <font class="preprocessor"></font><font class="preprocessor">#define MAX_FILE_NAME_LEN 256</font>
00028 <font class="preprocessor"></font><font class="preprocessor">#define MAX_DELETED_ITEMS 50 //pocet smazanych polozek, po kterem se provede reorganizace databaze</font>
00029 <font class="preprocessor"></font><font class="preprocessor">#define LOCKING_TIMEOUT 200  //kolikrat se budeme pokouset ziskat pristup k databazi, nez to polozime</font>
00030 <font class="preprocessor"></font><font class="preprocessor">#define LOCKING_SLEEP_TIME 10000 //na kolik mikrosekund usneme, nez zkusime opet ziskat pristup k databazi</font>
00031 <font class="preprocessor"></font><font class="preprocessor">#define R_ALL 3</font>
00032 <font class="preprocessor"></font>
00033 <font class="keyword">using</font> <font class="keyword">namespace </font>std;
00034 <font class="comment">// v knihovnach by se tohle nemelo delat. nam to ale nevadi :-)</font>
00035 
00036 
00037 <font class="keyword">extern</font> <font class="keywordtype">int</font> errno;
00038 
00039 
00040 
<a name="l00045"></a><a class="code" href="structFileInfoGdbmRecord.html">00045</a> <font class="keyword">struct </font><a class="code" href="structFileInfoGdbmRecord.html">FileInfoGdbmRecord</a> {
00046     <font class="keywordtype">int</font>         user_rights;
00047     <font class="keywordtype">int</font>         others_rights;
00048     <font class="keywordtype">char</font>        user_name[MAX_USER_NAME_LEN];
00049     <font class="keywordtype">char</font>        name[MAX_FILE_NAME_LEN];
00050 };
00051 
00052 
00053 
<a name="l00061"></a><a class="code" href="classFileInfo.html">00061</a> <font class="keyword">class </font><a class="code" href="classFileInfo.html">FileInfo</a> {
00062 <font class="keyword">public</font>:
<a name="l00063"></a><a class="code" href="classFileInfo.html#m0">00063</a>     <font class="keywordtype">int</font> <a class="code" href="classFileInfo.html#m0">user_rights</a>;   
<a name="l00064"></a><a class="code" href="classFileInfo.html#m1">00064</a>     <font class="keywordtype">int</font> <a class="code" href="classFileInfo.html#m1">others_rights</a>; 
<a name="l00065"></a><a class="code" href="classFileInfo.html#m2">00065</a>     string <a class="code" href="classFileInfo.html#m2">user_name</a>;  
<a name="l00066"></a><a class="code" href="classFileInfo.html#m3">00066</a>     string <a class="code" href="classFileInfo.html#m3">name</a>;       
00067     
00068     <a class="code" href="classFileInfo.html#a1">FileInfo</a>(<font class="keyword">const</font> <a class="code" href="classFileInfo.html">FileInfo</a> &amp;x); 
<a name="l00069"></a><a class="code" href="classFileInfo.html#a1">00069</a>     <a class="code" href="classFileInfo.html#a1">FileInfo</a>(){} 
00070     <a class="code" href="classFileInfo.html">FileInfo</a>&amp; <a class="code" href="classFileInfo.html#a2">operator=</a>(<a class="code" href="structFileInfoGdbmRecord.html">FileInfoGdbmRecord</a> &amp;x);
00071     <a class="code" href="classFileInfo.html#a3">operator FileInfoGdbmRecord</a>();
00072 };
00073 
00074 
<a name="l00094"></a><a class="code" href="classDirectoryDatabase.html">00094</a> <font class="keyword">class </font><a class="code" href="classDirectoryDatabase.html">DirectoryDatabase</a> {
00095 <font class="keyword">public</font>:
00096     <a class="code" href="classDirectoryDatabase.html#a0">DirectoryDatabase</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *<a class="code" href="classDirectoryDatabase.html#o1">db_name</a>) <font class="keywordflow">throw</font>(<a class="code" href="classFileError.html">FileError</a>, <a class="code" href="classGdbmError.html">GdbmError</a>);
00097    ~<a class="code" href="classDirectoryDatabase.html">DirectoryDatabase</a>();
00098     <font class="keywordtype">int</font> <a class="code" href="classDirectoryDatabase.html#a2">PutFileInfo</a>(<a class="code" href="classFileInfo.html">FileInfo</a> &amp;file);
00099     <font class="keywordtype">int</font> <a class="code" href="classDirectoryDatabase.html#a3">GetFileInfo</a>(string name, <a class="code" href="classFileInfo.html">FileInfo</a> &amp;info);
00100     <font class="keywordtype">int</font> <a class="code" href="classDirectoryDatabase.html#a4">DeleteFileInfo</a>(string &amp;name);
00101     <font class="keywordtype">int</font> <a class="code" href="classDirectoryDatabase.html#a5">LoadSubDir</a>(string &amp;name);
00102     <font class="keywordtype">void</font> IgnoreHidden(<font class="keywordtype">bool</font> x) { <a class="code" href="classDirectoryDatabase.html#o4">ignore_hidden</a> = x; }
00103     <font class="keywordtype">bool</font> IgnoreHidden() { <font class="keywordflow">return</font> <a class="code" href="classDirectoryDatabase.html#o4">ignore_hidden</a>; }
00104     <font class="keywordtype">void</font> <a class="code" href="classDirectoryDatabase.html#a8">PrintContent</a>();
00105 
00106 <font class="keyword">private</font>:
<a name="l00107"></a><a class="code" href="classDirectoryDatabase.html#o0">00107</a>     GDBM_FILE <a class="code" href="classDirectoryDatabase.html#o0">db_file</a>; 
<a name="l00108"></a><a class="code" href="classDirectoryDatabase.html#o1">00108</a>     string <a class="code" href="classDirectoryDatabase.html#o1">db_name</a>;  
<a name="l00109"></a><a class="code" href="classDirectoryDatabase.html#o2">00109</a>     string <a class="code" href="classDirectoryDatabase.html#o2">lock_name</a>; 
<a name="l00110"></a><a class="code" href="classDirectoryDatabase.html#o3">00110</a>     <font class="keywordtype">bool</font> <a class="code" href="classDirectoryDatabase.html#o3">locked</a>; 
<a name="l00111"></a><a class="code" href="classDirectoryDatabase.html#o4">00111</a>     <font class="keywordtype">bool</font> <a class="code" href="classDirectoryDatabase.html#o4">ignore_hidden</a>; 
<a name="l00112"></a><a class="code" href="classDirectoryDatabase.html#o5">00112</a>     <font class="keywordtype">int</font> <a class="code" href="classDirectoryDatabase.html#o5">num_of_deleted_items</a>; 
00113     
00114     <font class="keywordtype">int</font> <a class="code" href="classDirectoryDatabase.html#c0">File2Key</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *path, string &amp;key);
00115     <font class="keywordtype">int</font> <a class="code" href="classDirectoryDatabase.html#c1">LockDatabase</a>();
00116     <font class="keywordtype">int</font> <a class="code" href="classDirectoryDatabase.html#c2">UnlockDatabase</a>();
00117 };
00118 
00119 
00120 
00121 
00122 <font class="preprocessor">#endif //__DirectoryDatabase_h</font>
00123 <font class="preprocessor"></font>
00124 
</pre></div><hr><address><small>Generated on Fri Sep 19 10:13:26 2003 for smallFTPd by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
